<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Service Dashboard</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 0;
        }

        header {
            background: #4A90E2;
            color: white;
            padding: 18px;
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            position: relative;
        }

        .logout-btn {
            position: absolute;
            right: 15px;
            top: 12px;
            padding: 8px 14px;
            background: #ff4d4d;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .admin-btn {
            position: absolute;
            left: 15px;
            top: 12px;
            padding: 8px 14px;
            background: #222;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .wallet-bar {
            background: white;
            padding: 15px;
            margin: 10px;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 18px;
        }

        .add-money {
            background: #4A90E2;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
        }

        .container { padding: 15px; }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 15px;
        }

        .box {
            background: white;
            border-radius: 12px;
            padding: 20px 10px;
            text-align: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            cursor: pointer;
            transition: 0.2s;
        }

        .box:hover { transform: scale(1.05); }

        .icon {
            font-size: 35px;
            margin-bottom: 8px;
            color: #4A90E2;
        }

        .amount-box { 
            margin-top: 15px; 
            display: none;
        }

        .amount-btn {
            padding: 12px;
            width: 100%;
            background: #4A90E2;
            color: white;
            border-radius: 10px;
            margin-bottom: 10px;
            border: none;
            cursor: pointer;
            font-size: 18px;
        }

        #paymentTimerBox {
            display: none;
            background: #fff3cd;
            padding: 12px;
            margin: 10px;
            border-radius: 10px;
            border-left: 5px solid #ff9800;
            font-size: 16px;
        }

        .aeps-box { display: none; }

        .sub-box {
            background: #ffffff;
            padding: 15px;
            margin-top: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        }

        #hisabBox {
            display: none;
            background: white;
            padding: 15px;
            margin: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .hisab-entry {
            background: #e7f0ff;
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
        }
    </style>

    <script>

        let wallet = Number(localStorage.getItem("userWallet") || 0);
        let timerInterval = null;

        window.onload = function () {
            document.getElementById("walletBalance").innerText = wallet + " ‚Çπ";
            loadTimer();
        };

        function logoutUser() {
            window.location.href = "login.html";
        }

        function openAEPS() {
            const menu = document.getElementById("aepsMenu");
            menu.style.display = menu.style.display === "block" ? "none" : "block";
        }

        function openHisab() {
            const box = document.getElementById("hisabBox");
            box.style.display = box.style.display === "block" ? "none" : "block";
        }

        function addHisabEntry() {
            let detail = prompt("Lena / Dena detail likhen:");
            if (detail) {
                let div = document.createElement("div");
                div.className = "hisab-entry";
                div.innerText = detail;
                document.getElementById("hisabList").appendChild(div);
            }
        }

        // ADD MONEY
        function addMoney() {
            document.getElementById("amountBox").style.display = "block";
        }

        function payAmount(amount) {

            if (localStorage.getItem("paymentLock")) {
                alert("Aapka pichla payment pending hai. Admin approval ka wait karein.");
                return;
            }

            let remark = prompt("Remark likhen:");

            let req = {
                id: Date.now(),
                amount: amount,
                remark: remark,
                status: "pending"
            };

            let all = JSON.parse(localStorage.getItem("paymentRequests") || "[]");
            all.push(req);
            localStorage.setItem("paymentRequests", JSON.stringify(all));

            localStorage.setItem("paymentLock", "true");

            startTimer(5);

            let upiURL =
                "upi://pay?pa=paytmqr5m9yhr@ptys&pn=Admin&am=" +
                amount +
                "&cu=INR&tn=" +
                encodeURIComponent(remark);

            window.location.href = upiURL;

            alert("Payment Request Admin tak bhej diya ‡§ó‡§Ø‡§æ.\nApproval ka wait karein.");
        }

        function startTimer(min) {
            let end = Date.now() + min * 60 * 1000;
            localStorage.setItem("paymentTimerEnd", end);

            document.getElementById("paymentTimerBox").style.display = "block";

            timerInterval = setInterval(function () {
                let now = Date.now();
                let diff = end - now;

                if (diff <= 0) {
                    clearInterval(timerInterval);
                    localStorage.removeItem("paymentTimerEnd");
                    document.getElementById("paymentTimerBox").style.display = "none";
                    alert("Time End! Payment auto cancel.");
                    localStorage.removeItem("paymentLock");
                    return;
                }

                let m = Math.floor(diff / 60000);
                let s = Math.floor((diff % 60000) / 1000);

                document.getElementById("timerCountdown").innerText =
                    (m < 10 ? "0" + m : m) + ":" + (s < 10 ? "0" + s : s);

            }, 1000);
        }

        function loadTimer() {
            let end = localStorage.getItem("paymentTimerEnd");
            if (!end) return;

            if (Date.now() > end) {
                localStorage.removeItem("paymentTimerEnd");
                return;
            }

            document.getElementById("paymentTimerBox").style.display = "block";
            startTimer(0);
        }
    </script>

</head>

<body>

<header>
    <button class="admin-btn" onclick="window.location='admin.html'">Admin</button>
    My Dashboard
    <button class="logout-btn" onclick="logoutUser()">Logout</button>
</header>

<div class="wallet-bar">
    <div><b>Wallet Balance:</b> <span id="walletBalance">0 ‚Çπ</span></div>
    <div class="add-money" onclick="addMoney()">Add Money</div>
</div>

<div id="paymentTimerBox">
    ‚è≥ Payment Time Remaining: <b id="timerCountdown">00:00</b>
</div>

<div class="container">

    <div id="amountBox" class="amount-box">
        <button class="amount-btn" onclick="payAmount(200)">‚Çπ200 Add</button>
        <button class="amount-btn" onclick="payAmount(500)">‚Çπ500 Add</button>
        <button class="amount-btn" onclick="payAmount(1000)">‚Çπ1000 Add</button>
        <button class="amount-btn" onclick="payAmount(2000)">‚Çπ2000 Add</button>
    </div>

    <div class="grid">

        <div class="box"><div class="icon">üì±</div>Mobile Recharge</div>
        <div class="box"><div class="icon">üì∫</div>DTH Recharge</div>
        <div class="box"><div class="icon">üí°</div>Electricity Bill</div>
        <div class="box"><div class="icon">üí∏</div>Send Money</div>

        <div class="box" onclick="openAEPS()">
            <div class="icon">üßæ</div>AEPS Service
        </div>

        <div class="box" onclick="openHisab()">
            <div class="icon">üìò</div>Personal Hisab
        </div>

        <div class="box"><div class="icon">üì•</div>Mudarabah Apply</div>
        <div class="box"><div class="icon">üöì</div>Chalan Deposit</div>
        <div class="box"><div class="icon">üì§</div>Accept UPI Payment</div>

    </div>

    <div id="aepsMenu" class="aeps-box">
        <div class="sub-box">üîç Balance Enquiry</div>
        <div class="sub-box">üí∞ Cash Withdrawal</div>
        <div class="sub-box">üì§ Cash Deposit</div>
        <div class="sub-box">üìÑ Mini Statement</div>
    </div>

    <div id="hisabBox">
        <h3>üìò Personal Hisab</h3>
        <button onclick="addHisabEntry()">‚ûï Add Entry</button>
        <div id="hisabList"></div>
    </div>

</div>

</body>
</html>
